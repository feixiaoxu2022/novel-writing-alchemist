# Content Quality Basic Layer - LLM Judge Criteria
# 版本：v1.9
# 创建时间：2026-02-05
# 最后更新：2026-02-13
# 说明：定义content_quality维度basic层的检查项的评估标准
#
# 版本历史：
# v1.9 (2026-02-13): 新增outline_execution_fidelity（大纲执行忠实度）检查项，验证Agent设计的outline.json与实际chapters的一致性
# v1.8 (2026-02-13): 新增"内容重复注水"检查项（章节间克隆、交替重复、段内重复）和"章节长度稳定性"检查项（后期萎缩检测），均可程序化实现
# v1.7 (2026-02-13): 逻辑硬伤新增narrative_perspective_error类型（叙事视角/人称代词错乱），type从三选一变为四选一
# v1.6 (2026-02-12): 新增narrative_tone_match（叙事调性匹配）检查项，验证文笔风格与题材类型是否搭配
# v1.3 (2026-02-06): 新增full_narrative_content（完整叙事文本）检查项，区分完整小说正文vs大纲罗列，识别偷懒写大纲的行为
# v1.2 (2026-02-06): 新增character_design_adherence（人物设计遵循度）检查项，验证plan阶段设计与execute阶段实际表现的一致性
# v1.1 (2026-02-05): 修正主题一致性和情节推进的返回格式，从评分格式改为matched格式，与checker解析逻辑保持一致
# v1.0 (2026-02-05): 初始版本，定义6个basic层检查项的LLM评估标准

## 主题一致性
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的范围约束**：
  - ✅ 只检查：故事的核心主题是否从开篇到结尾保持一致，主线是否清晰
  - ❌ 不检查：逻辑硬伤、设定冲突、章节编号错误、角色本体矛盾、世界观规则冲突
  - ❌ 即使逻辑硬伤会"削弱主题表达"，也不要归入本项，那是"检查项19:逻辑硬伤"的范围

  **不合格（matched: false）：主题严重漂移**
  - 开篇是复仇故事，中段变成商战，结尾又变修仙（**主题类型完全换了**）
  - 前后主题无关联，读者会困惑"这到底是什么故事"
  - 核心主题中途被完全替换，无法识别作品的统一主题
  - 示例：开篇定位"校园爱情"，中段变"悬疑探案"，结尾变"科幻穿越"（主题完全散了）

  **合格（matched: true）：主题基本一致**
  - 核心主题贯穿始终（如复仇主题从开篇到结尾都在推进）
  - 允许有支线（如复仇过程中涉及商业手段、权谋布局），但这些是实现主题的方式，不是新主题
  - 主题可以有深化（如从单纯复仇升华为正义），但核心不变
  - 所有情节都围绕核心主题展开，虽然可能有偏离但主线清晰
  - 示例：始终是"执念救赎+爱与牺牲"主题，虽然表现形式（副本、规则）有变化，但主题不变

  **严格区分：主题漂移 vs 逻辑硬伤**
  - ✅ 真主题漂移：开篇是爱情故事 → 中段变复仇故事 → 结尾变修仙故事（主题类型完全换了）
  - ❌ 不是主题漂移：始终是"执念救赎"主题，但角色身份设定前后矛盾（这是逻辑硬伤，不是主题漂移）
  - ❌ 不是主题漂移：始终是"复仇"主题，但章节编号错乱（这是结构问题，不是主题漂移）
  - ❌ 不是主题漂移：始终是"爱情"主题，但世界观规则前后冲突（这是逻辑硬伤，不是主题漂移）

  **具体排除清单**（这些不属于本项）：
  - ⚠️ 不属于本项：角色本体设定前后矛盾（如"执念投影"→"系统工具"→"植物人"）
  - ⚠️ 不属于本项：章节编号/副本序号错乱（如第4→第5→第7→第8编号跳跃）
  - ⚠️ 不属于本项：世界观规则冲突（如"绑定规则"前后矛盾）
  - ⚠️ 不属于本项：梗概与正文事实冲突（这是客观事实矛盾）
  - ⚠️ 不属于本项：因果链断裂、时间线错乱（这些都是逻辑硬伤）

  **验证要点**：
  1. 提取creative_intent.json中的核心主题（如"复仇"、"爱情"、"成长"、"救赎"）
  2. 检查各章节是否持续推进**这个主题类型**（而不是检查逻辑是否一致）
  3. 区分"主题漂移"（主题类型完全换了）vs"逻辑硬伤"（主题不变但逻辑有问题）
  4. **关键判断**：如果主题意图层面一致（如都是"救赎"主题），即使有逻辑冲突，也应判定主题一致

  **判断流程**：
  - 先问：核心主题类型（复仇/爱情/成长/救赎等）是否从开篇到结尾保持一致？
  - 如果主题类型一致 → matched=true（即使有逻辑硬伤也不影响主题一致性判定）
  - 如果主题类型完全换了 → matched=false（真主题漂移）
  - 不要因为"逻辑硬伤削弱了主题表达"就判定为主题不一致

  请判断主题是否保持一致，回复JSON格式：{"matched": true/false, "reason": "只说明核心主题类型是否一致，不要提及逻辑硬伤、设定冲突等问题"}

---

## 主要角色一致性
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的范围约束**：
  - ✅ 只检查：故事的主角（第一/第二主角）是否从开篇到结尾持续存在并保持核心身份
  - ✅ 检查主角是否中途被替换、消失、或被配角抢占戏份导致主角地位丧失
  - ❌ 不检查：主角的性格是否一致（那是"人物设定一致性"的范围）
  - ❌ 不检查：主角表现是否符合设计文档（那是"人物设计遵循度"的范围）
  - ❌ 不检查：客观事实矛盾（那是"逻辑硬伤"的范围）

  **不合格（matched: false）：主角存续性问题**
  - **主角消失**：主角在某章之后完全不再出现，没有任何交代（非剧情需要的暂时离场）
  - **主角被替换**：前几章的主角是A，后几章突然换成B成为叙事中心，A沦为配角或消失
  - **主角身份断裂**：同一个"主角"在前后章节中变成了完全不同的人（不是性格变化，而是身份层面的断裂——如前文是警察张三，后文变成了商人李四，且无剧情解释）
  - **主角戏份被严重挤占**：主角沦为旁观者，配角占据了绝大部分（>70%）的叙事视角和决策权
  - **多主角场景中某主角被遗忘**：如双男主/双女主设定，其中一个主角在中后期完全消失

  **合格（matched: true）：主角持续存在且保持核心地位**
  - 主角从开篇到结尾持续出现在叙事中，是故事的核心推动者
  - 如果有暂时离场（如被囚禁、失联），有明确的剧情交代，且后续回归
  - 多主角场景中，各主角都有足够的戏份和存在感
  - 允许叙事视角偶尔切换到配角（如展示反派视角），但主角始终是故事中心
  - 允许主角身份的剧情揭示（如"原来他不是普通人而是卧底"），这是剧情设计而非身份断裂

  **严格区分：主角存续性 vs 其他问题**：
  - ✅ 本项关注：主角"还在不在"、"还是不是主角"
  - ❌ 不是本项：主角性格变了（那是人物设定一致性）
  - ❌ 不是本项：主角表现不符合设计（那是人物设计遵循度）
  - ❌ 不是本项：主角做了不合逻辑的事（那是逻辑硬伤）
  - ⚠️ 边界情况：主角身份揭示（如"他其实是XXX"）→ 如果是同一个人的身份层被揭开，不算身份断裂，算合格
  - ⚠️ 边界情况：主角死亡但以其他形式存在（如回忆、精神影响）→ 如果有剧情铺垫且叙事中心仍围绕该角色，算合格

  **验证要点**：
  1. 从characters.json或creative_intent.json中识别主角（通常是前1-2个main_character）
  2. 逐章检查：主角是否出现？是否是叙事中心？
  3. 如果主角在某章未出现，是否有合理的剧情原因？
  4. 多主角场景中，各主角的戏份是否均衡？是否有被遗忘的主角？
  5. 叙事视角是否持续以主角为中心？配角视角是否只是偶尔穿插？

  **判断流程**：
  - 先问：谁是主角？（从设计文档或前几章识别）
  - 再问：主角是否从头到尾都在故事中？
  - 如果有主角缺席的章节，是否有合理的剧情交代？
  - 如果主角的叙事戏份被大量挤占（>70%视角给了配角），判定不合格
  - 如果主角中途被替换且无剧情解释，判定不合格

  请判断主角是否持续存在并保持核心地位，回复JSON格式：{"matched": true/false, "reason": "说明主角在各章节的存在情况，如有问题指出在哪里消失/被替换/被挤占"}

---

## 人物设定一致性
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的范围约束**：
  - ✅ 只检查：同一角色在不同章节之间的性格特质、行为模式是否前后一致（execute内部一致性）
  - ✅ 对比基准是"章节之间的前后对比"（chapter_01的角色A vs chapter_05的角色A）
  - ❌ 不检查：角色表现是否符合characters.json设计文档（那是"人物设计遵循度"的范围）
  - ❌ 不检查：客观事实错误、世界观设定矛盾、物品数量冲突、时间线错误（那是"逻辑硬伤"的范围）
  - ❌ 不检查：剧情揭示节奏问题（如misperception何时消解、secret何时揭示）

  **不合格（matched: false）：人物性格/行为真崩坏**
  - 前几章表现为聪明绝顶 → 后面突然降智做蠢事（无合理原因，如明明知道陷阱还主动跳）
  - 前几章表现为善良温柔 → 后面突然残忍冷血（无铺垫无转折）
  - 前几章表现为武功高强 → 后面被小喽啰打败（能力水平前后不一致）
  - 人物核心动机前后自相矛盾（如前文"想复仇"，后文"不想复仇"，无转折解释）
  - 同一角色的性格底色在章节间反复摇摆（如第1章冷静→第2章冲动→第3章又冷静→第4章又冲动，无情境解释）

  **合格（matched: true）：性格/行为保持一致**
  - 角色的性格底色、行为模式、核心动机在各章节间保持稳定
  - 如果人物发生转变，有合理的铺垫和动机（如经历背叛后从单纯变谨慎）
  - 允许在情境压力下的合理反应（如谨慎的人被逼急了变莽撞，但事后回归谨慎）
  - 允许因剧情事件导致的合理行为变化（如得知真相后态度转变、经历创伤后性格改变）

  **区分"人设崩坏"vs"合理变化"vs"其他问题"**：
  - ✅ 不算人设崩坏：谨慎的人被逼急了变莽撞（有情境压力，事后回归，合理）
  - ✅ 不算人设崩坏：单纯的人经历背叛后变谨慎（有铺垫的性格成长）
  - ✅ 不算人设崩坏：角色得知隐藏真相后行为模式改变（如发现对方身份后从防备变信任）——这是剧情驱动的合理转变
  - ❌ 真人设崩坏：聪明人无缘无故反复降智（无铺垫，性格特质不稳定）
  - ❌ 真人设崩坏：同一角色的性格底色在各章之间无规律地来回切换
  - ⚠️ 不属于本项：枕巾数量从40对变成50对再变1对（这是客观事实错误，属于"逻辑硬伤"）
  - ⚠️ 不属于本项：角色身份从"执念投影"变成"系统工具"再变"植物人"（这是世界观设定矛盾，属于"逻辑硬伤"）
  - ⚠️ 不属于本项：时间线错乱、空间矛盾（这些是"逻辑硬伤"）
  - ⚠️ 不属于本项：角色表现不符合characters.json的设计（那是"人物设计遵循度"）

  **验证要点**：
  1. 扫描所有章节，提取各角色在不同章节中的性格表现和行为模式
  2. 对比同一角色在前后章节中的表现：性格底色是否稳定？核心动机是否一贯？
  3. 如果有性格转变，判断是否有合理的铺垫和动机（剧情事件触发的转变是合理的）
  4. **严格排除**：不要把客观事实错误（数量、身份本质、时间线）归入本项
  5. **严格排除**：不要把角色与characters.json设计文档的对比归入本项（那是另一个检查项）

  **判断流程**：
  - 先问：这是人物性格/行为在章节间的问题，还是客观事实/世界观的问题？
  - 如果是客观事实错误 → 不属于本项，跳过
  - 如果是角色与design文档不符 → 不属于本项（那是人物设计遵循度），跳过
  - 如果是人物性格/行为在章节间不一致 → 继续判断：有没有合理的剧情铺垫导致这种变化？
  - 有合理铺垫 → matched=true（合理成长/转变）
  - 无合理铺垫、性格无故崩坏或反复摇摆 → matched=false

  请判断人物设定是否一致，回复JSON格式：{"matched": true/false, "reason": "只说明角色的性格/行为/动机在各章节之间是否一致，不要提及客观事实错误，不要对比characters.json设计文档"}

---

## 逻辑硬伤
llm_judge_criteria: |
  # 评分标准（matched: true/false + 结构化硬伤清单）

  **【重要】本检查项的范围约束**：
  - ✅ 检查：客观事实前后矛盾、世界观设定冲突、时空逻辑错误、数量/状态冲突
  - ✅ 这里应该检查那些从"人物设定一致性"排除的问题（如枕巾数量冲突、身份本质设定互斥）
  - ❌ 不检查：纯粹的人物性格/行为一致性问题（那是"检查项18:人物设定一致性"的范围）

  **不合格（matched: false）：有逻辑硬伤**
  - **生死状态矛盾**：前面说某人已死（尸体腐烂），后面又活着出现（无解释）
  - **判决/事实矛盾**：前面判无期徒刑，后面变成死刑（无解释的矛盾）
  - **时间线错乱**：前面是2020年，后面突然变2018年（时间倒流）
  - **空间矛盾**：同一场景下，前一章在北京，下一章在上海（无交代移动）
  - **客观数量冲突**：枕巾从40对→50对→只剩1对→又变4对（数字自相矛盾）
  - **角色本体设定互斥**：角色身份从"执念投影"→"系统工具"→"植物人"，三种解释并存且无统一
  - **世界观规则冲突**：前面建立的规则A，后面又用规则B覆盖（无解释）
  - **能力边界突变**：角色突然展现前文未铺垫的能力（如NPC突然能访问后台监控），与设定冲突
  - **叙事视角/人称错乱**：第一人称"我"与第三人称"他"在同一段落内无故切换；主语指代对象搞反（如"不是我可以进入，而是你可以进入"写反了主语）；角色A的限制视角段落中突然出现只有角色B才知道的内心想法；对话中人称代词指向错误导致读者无法分辨谁在说话

  **合格（matched: true）：无逻辑硬伤**
  - 前后事件、设定、时间线、空间逻辑、客观数量保持一致
  - 如果有看似矛盾的地方，有合理的解释（如假死、改判、规则升级等）

  **重要区分**：
  - ✅ 真硬伤：枕巾数量40→50→1→4，前后数字冲突（客观事实错误）
  - ✅ 真硬伤：角色身份A→B→C三种解释并存（世界观设定互斥）
  - ✅ 真硬伤：前面说死了，后面又活了（无任何解释）
  - ✅ 真硬伤：主角是男性，叙述中突然出现"她整理了一下裙摆"（人称/属性错乱）
  - ✅ 真硬伤：角色A的第一人称段落中出现"他想到了自己的秘密"——此处"他"指代A还是别人？（视角混乱）
  - ❌ 不算硬伤：商业对手突然变弟弟（铺垫不足，但不是前后矛盾）
  - ❌ 不算硬伤：背景不清的女子选秀（合理性不足，但不是逻辑矛盾）
  - ⚠️ 不属于本项：人物从聪明突然变愚蠢（这是性格一致性问题，属于检查项18）

  **验证要点**：
  1. 扫描所有章节，查找前后矛盾的**客观事实**（生死、判决、时空、数量、身份本质）
  2. 如果发现矛盾，检查是否有解释（如假死、改判的剧情）
  3. 只标记"硬伤"（明确的前后矛盾），不标记"不合理"（铺垫不足）
  4. **包含客观物品/数量**：如枕巾数量前后冲突，应归入本项
  5. **包含世界观设定**：如角色本体身份的多版本互斥，应归入本项
  6. **包含叙事视角错误**：检查人称代词是否一致（第一人称/第三人称不应无故切换）、主语指代是否清晰（"我"、"你"、"他"指向是否明确且正确）、限制视角是否被打破（角色A的POV段落中不应出现只有B知道的信息）

  **判断流程**：
  - 先问：这是客观事实/世界观的矛盾，还是人物性格/行为的问题？
  - 如果是客观事实/世界观矛盾 → 继续判断是否有逻辑硬伤
  - 如果是人物性格/行为问题 → 不属于本项，跳过

  **输出格式要求**：
  对发现的每一处硬伤，必须标注**类型(type)**、**严重程度(severity)**和**可修复性(fixability)**。

  type 取值（四选一）：
  - `factual_consistency`：客观事实/数量/状态前后矛盾（时间线数字冲突、物品数量变化、生死判决翻转等）
  - `worldbuilding_coherence`：世界观/规则体系不自洽（系统设定互斥、能力边界突变、魔法/科技规则冲突等）
  - `spatiotemporal_continuity`：时空转换断链（地点无交代跳转、强制事件无故消失、场景连续性断裂等）
  - `narrative_perspective_error`：叙事视角/人称代词错乱（第一人称与第三人称混用、主语指代对象搞反、"我"和"你"混淆、角色A的视角段落中突然出现角色B才能知道的内心独白等）

  severity 取值（三选一）：
  - `critical`：核心事实彻底翻转，无法自圆其说（死人复活、判决完全相反）
  - `major`：明确的前后矛盾，缺少任何解释（数值冲突、规则覆盖）
  - `minor`：解释缺失但不绝对矛盾，存在勉强自洽的可能（铺垫极弱的转折、可解释但未解释的跳变）

  fixability 取值（二选一）：
  - `structural`：**结构性不可修**——矛盾深入多章情节因果链，修改此处会导致后续大量情节不成立，需要大幅重写才能修复。判断标准：(1)矛盾点被后续3+章的情节因果依赖，或(2)涉及核心角色的生死/身份/动机等情节主干，或(3)修复需要重写超过30%的已有内容
  - `fixable`：**局部可修**——只需修改少量文字（几句话/几个数字/几个段落）即可消除矛盾，不影响情节主线。判断标准：(1)矛盾局限于1-2处具体描述，或(2)涉及的是装饰性细节（年龄、数量、外貌等），或(3)修改后下游情节仍然成立

  **fixability 判断要点**：
  - 关键问题：如果我改掉矛盾点A，后面的情节B、C、D还能成立吗？
  - 能成立 → fixable（局部可修）
  - 不能成立（要连锁改B、C、D） → structural（结构性不可修）
  - 举例：
    · "角色25岁→30岁" —— 改一个数字即可，fixable
    · "角色第3章死了，但第7-12章是关键推动者" —— 改活会影响第3章的死亡情节线，改死会废掉7-12章，structural
    · "枕巾40对→50对" —— 统一一个数字即可，fixable
    · "角色身份是A→又是B→又是C，三条线索分别引出不同结局" —— structural

  请回复JSON格式：
  - 有硬伤时：{"matched": false, "flaw_count": 3, "flaws": [{"type": "factual_consistency", "severity": "major", "fixability": "fixable", "location": "chapter_02 → chapter_03", "description": "倒计时从30天骤变为15天"}, {"type": "narrative_perspective_error", "severity": "major", "fixability": "fixable", "location": "chapter_05第3段", "description": "主角陈默的第一人称叙述中突然出现'她心想这个秘密不能让陈默知道'，打破了限制视角"}, {"type": "worldbuilding_coherence", "severity": "critical", "fixability": "structural", "location": "chapter_03 → chapter_07-12", "description": "角色在第3章已确认死亡，但第7-12章均以该角色为核心推动情节"}], "reason": "存在3处逻辑硬伤，其中1处结构性不可修（角色生死矛盾贯穿多章），2处局部可修...（总结性说明）"}
  - 无硬伤时：{"matched": true, "flaw_count": 0, "flaws": [], "reason": "各章节客观事实、世界观、时空逻辑保持一致"}

---

## 语言纯净性
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **不合格（matched: false）：不合理的多语言混用**
  - 中英混杂无意义：'他very生气地说'、'这个idea真的不错'、'他feeling到了危险'
  - 日文混用：'今天很sugoi呢'（无情节需要）
  - 大段外语无翻译（非角色对话场景）

  **合格（matched: true）：语言使用合理**
  - 主要叙事语言统一（如中文故事就用中文叙事）
  - 合理的外语使用（情节必需）：
    * 人名：'John是一位美国商人'（人名本身就是英文）
    * 品牌名：'他们在Starbucks见面'（专有品牌名）
    * 角色对话：'她说了一句"Good morning"'（角色说外语）
    * 专业术语：'AI技术'、'DNA检测'（约定俗成的术语）

  **判断标准**：
  - 如果是人名、地名、品牌、术语、角色说外语 → 合理
  - 如果是无意义的语言炫技（中英混杂句子） → 不合理

  **验证要点**：
  1. 扫描所有章节，查找外语（英文、日文等）出现位置
  2. 判断每处外语是否有情节必要性（人名/品牌/对话/术语）
  3. 如果有大量无意义的混用，判定为不合格

  请判断语言使用是否纯净，回复JSON格式：{"matched": true/false, "reason": "说明是否有不合理混用，或确认语言使用合理"}

---

## 情节推进
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **不合格（matched: false）：缺乏实质情节推进**
  - 章节主要由静态对话或内心独白构成（占比>70%）
  - 无具体的故事事件发生（两人站着聊天，讨论情感和想法）
  - 场景静止，无时间/空间推进
  - 角色无实质性行动，仅停留在情感表达
  - 故事事件数量少于2个，无法构成基本的情节推进

  **合格（matched: true）：有基本的情节推进**
  - 有一定的故事事件（至少2-3个具体事件）
  - 事件与情感描写基本平衡（事件占比40%以上）
  - 有场景变化或时间推进
  - 角色有具体行动，不仅是对话
  - 事件之间有基本的逻辑关联，推动故事发展

  **验证提示**：
  1. **故事事件密度**：
     - 统计具体的故事事件数量（行动、发现、转折、冲突）
     - 区分"事件"（有实质推进）vs"描写"（静态展示）

  2. **内容占比分析**：
     - 故事事件占比是否≥40%？
     - 纯对话和内心独白占比是否<70%？

  3. **情节推进节奏**：
     - 是否有明确的时间/空间变化？
     - 角色是否有具体行动（而非仅对话）？
     - 事件之间是否有逻辑关联？

  4. **典型不合格问题**：
     - 出现"俩人站着聊天"且无实质内容的场景
     - 大段内心独白但无外部事件
     - 场景静止、无故事推进

  请判断章节是否有足够的情节推进，回复JSON格式：{"matched": true/false, "reason": "具体说明事件数量、内容占比、是否有实质推进"}

---

## 人物设计遵循度
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的范围约束**：
  - ✅ 只检查：角色"是什么样的人"——性格特质、核心动机方向、行为模式是否符合characters.json的设计
  - ✅ 这是检查Plan阶段（characters.json设计文档）vs Execute阶段（chapters/*.md实际表现）的一致性
  - ❌ 不检查：章节之间的人物性格一致性（那是检查项18）、主角是否换人（那是检查项17）、客观事实错误（那是检查项19）
  - ❌ 不检查：剧情揭示时机/叙事节奏问题（如misperception被过早消解、hidden_connection提前暴露、关系发展节奏过快）——这些是"故事怎么讲"的问题，不是"人设对不对"的问题

  **不合格（matched: false）：实际表现与设计严重不符**
  - **性格特质不符**：characters.json定义"沉默寡言、外冷内热" → chapters中表现为话痨、热情外向、感情外露
  - **性格特质不符**：characters.json定义"倔强、细腻、隐忍" → chapters中表现为软弱、粗犷、情绪失控
  - **核心能力不符**：characters.json定义"聪明绝顶、策略大师" → chapters中表现为愚钝、判断力差、缺乏谋略
  - **核心动机偏离**：characters.json定义动机是"复仇" → chapters中完全不提复仇，只关心赚钱或其他目标
  - **背景设定未体现**：characters.json定义"江湖经验丰富" → chapters中表现为江湖小白、对规则一无所知
  - **关系设定未遵循**：characters.json定义A和B是"多年老友" → chapters中表现为初次相识、互相不了解

  **合格（matched: true）：实际表现符合设计**
  - characters.json中定义的traits（性格特质）在chapters中得到体现
  - characters.json中定义的motivation（核心动机）在chapters中持续驱动角色行为
  - characters.json中定义的background（背景经历）在chapters中影响角色的判断和选择
  - characters.json中定义的relationships（关系设定）在chapters中得到呈现
  - 允许在设计基础上的合理发挥和细节补充，只要不违背核心设定

  **与其他检查项的严格区分**：
  - **vs 检查项18（人物设定一致性）**：检查项18检查execute内部的一致性（chapter_01 vs chapter_02），本项检查plan vs execute（设计文档 vs 实际表现）
  - **vs 检查项19（逻辑硬伤）**：检查项19检查客观事实矛盾，本项检查人物性格/动机是否遵循设计
  - **关键区别**：本项的对比基准是characters.json设计文档，而非章节之间的前后对比

  **严格排除：叙事节奏/剧情安排类问题（不属于本项）**：
  以下问题都是"故事怎么讲"的范畴，不是"角色像不像设计的那个人"，不要归入本项：
  - ⚠️ misperception_of_other被过早消解（如设计要求A误以为B是NPC，但第1章就揭示了B的真实身份）→ 这是剧情节奏问题
  - ⚠️ hidden_connection被过早暴露（如设计的隐藏关联在前几章就被揭示，而非中后期）→ 这是叙事安排问题
  - ⚠️ 关系发展节奏偏快/偏慢（如设计预期逐步升温，实际快速进入亲密期）→ 这是节奏控制问题
  - ⚠️ secret揭示时机不对（如设计要求后期揭秘，实际前期就暴露了）→ 这是悬念管理问题
  - ⚠️ 支撑角色出场时机/频率与设计不一致 → 这是结构安排问题
  - 📌 判断标准：如果角色的**性格/动机/行为模式**本身是对的（该冷的冷、该深情的深情），只是**剧情事件的揭示节奏**与设计不同，那角色人设是符合的，应判pass

  **验证要点**：
  1. **读取设计文档**：提取characters.json中每个main_character的核心设定
     - traits（性格特质）：如"沉默寡言"、"外冷内热"、"倔强"、"细腻"
     - motivation（核心动机方向）：如"复仇"、"保护家人"、"追求真相"
     - background（背景经历）：如"江湖经验丰富"、"曾受重大创伤"
     - relationships（关系设定）：如"A和B是多年老友"、"A暗恋B"

  2. **检查实际表现**：扫描所有章节，查看角色的实际行为和对话
     - 性格特质是否体现：定义"沉默寡言" → 实际是否话少？定义"外冷内热" → 表面是否冷淡但关键时刻有担当？
     - 核心动机是否驱动：定义"复仇" → 行为是否围绕复仇展开？是否持续推进复仇目标？
     - 背景设定是否影响：定义"江湖经验丰富" → 遇事是否展现江湖智慧？对江湖规则是否熟悉？
     - 关系设定是否呈现：定义"多年老友" → 互动是否展现默契和深厚感情？

  3. **容错范围**：
     - ✅ 合理发挥：设计未明确的细节，可以合理补充（如设计说"性格内向"，实际补充"喜欢独处看书"）
     - ✅ 合理深化：在设计基础上的深化演绎（如设计说"外冷内热"，实际展现"表面拒人千里但暗中帮助"）
     - ✅ 节奏差异：misperception/hidden_connection的揭示时机与设计不同，但角色性格本身没变（这是叙事节奏问题，不扣分）
     - ❌ 方向偏离：实际表现与设计的核心方向相反（如设计"内向"实际"外向"，设计"冷静"实际"冲动"）
     - ❌ 核心缺失：设计的核心特质在实际中完全未体现（如设计"复仇"但章节中从不提及）

  **判断流程**：
  1. 先读取characters.json，列出每个主角的核心设定（traits/motivation/background/relationships）
  2. 再扫描所有章节，提取角色的实际表现（对话、行动、心理活动）
  3. **只对比"人是不是那个人"**：设计的traits是否体现？motivation方向是否一致？background是否影响行为？relationships基调是否呈现？
  4. **主动排除叙事节奏问题**：如果发现misperception被提前揭示、hidden_connection过早暴露、关系升温过快等，先问自己——这是"角色性格/动机变了"还是"剧情事件的安排节奏变了"？如果是后者，不影响本项判定
  5. 如果核心设定（至少2-3项重要特质）在实际中得到体现 → matched=true
  6. 如果核心设定与实际表现严重不符（性格方向相反或核心动机完全缺失） → matched=false

  **示例分析**：

  **✅ 符合设计的案例**：
  ```
  设计（characters.json）：
  - 程远山：沉默寡言、外冷内热、对苏小满有愧疚感

  实际表现（chapters/*.md）：
  - 第1章：话很少，递烟时没多说话（体现"沉默寡言"）
  - 第2章：暴雨中默默为苏小满买红丝巾（体现"外冷内热"）
  - 第4章：告白时说"欠你的"（体现"愧疚感"）

  判断：核心特质在实际中都有体现 → matched=true
  ```

  **❌ 不符合设计的案例**：
  ```
  设计（characters.json）：
  - 角色A：沉默寡言、外冷内热、理性克制

  实际表现（chapters/*.md）：
  - 各章节中话痨、热情外向、感情外露、冲动行事

  判断：实际表现与设计核心特质完全相反 → matched=false
  ```

  **⚠️ 注意事项**：
  - 本项只检查plan vs execute的一致性，不要检查execute内部的前后一致性
  - 如果chapters中角色性格前后矛盾（如chapter_01冷静、chapter_02冲动），那是检查项18的范围，不是本项
  - 如果characters.json中某角色完全没在chapters中出现，那是检查项17的范围，不是本项
  - 本项关注的是：如果角色出现了，他的表现是否符合当初的设计
  - **最易误判的情况**：misperception_of_other / secret_fear / hidden_connection 的揭示节奏与设计不同。只要角色自身的性格和动机方向没变，这类问题不应导致fail。例如：设计要求A前期误以为B是NPC，实际第1章就认出B是真人——但如果A的性格（冷静/深情/隐忍等）本身没走样，那人设是符合设计的，只是剧情安排不同

  请判断角色实际表现是否符合设计文档，回复JSON格式：{"matched": true/false, "reason": "具体说明哪些核心设定得到体现或未体现，引用characters.json和具体章节的证据"}

---

## 完整叙事文本
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的核心目标**：
  - ✅ 只检查：章节内容是完整的小说正文（有场景、对话、动作细节），还是事件罗列的简略大纲
  - ✅ 这是区分"合格小说"和"偷懒大纲"的底线检查
  - ❌ 不检查：情节推进密度（那是检查项22）、叙事质量高低（那是advanced层）

  **不合格（matched: false）：大纲式章节**

  **典型特征1：有大纲性质的结构标题**
  ```markdown
  # 第2章：第一次尝试

  **核心事件**：陆沉试图转移关键证人...
  **情感基调**：焦虑、困惑、无力感
  **关键场景**：
  1. **证人的重要性**
     - 陆沉在技术科查阅档案...
     - 陈默提醒："..."
  2. **转移计划**
     - 陆沉决定先把林深转移到安全屋...

  **本章悬念**：为什么转移证人会加速倒计时？
  **字数预估**：8500字
  ```
  **问题**：出现"核心事件"、"情感基调"、"关键场景"、"本章悬念"、"字数预估"等大纲性质的标题和结构

  **典型特征2：内容是要点列举而非叙事**
  ```markdown
  1. **证人的重要性**
     - 陆沉在技术科查阅档案，发现林深掌握关键证据
     - 陈默提醒："陆队，这个证人如果出事，至少一百人会死"
     - 陆沉看着时间：19:00，距离23:00还有4小时
  ```
  **问题**：用"- 要点1 - 要点2 - 要点3"的列举式，而非连贯的叙事文本

  **典型特征3：事件流水账式罗列**
  ```markdown
  林羽接到神秘电话 → 调查线索 → 发现真相 → 决定反击 → 最终成功
  ```
  **问题**：用"→"连接事件，像流程图而非小说

  **典型特征4：元数据暴露（创作规划信息）**
  - 出现"字数预估"、"情感基调"、"本章悬念"等作者视角的规划信息
  - 这些是创作者的工作笔记，不应出现在正式章节中

  **合格（matched: true）：完整的小说正文**

  **应有的特征**：
  ```markdown
  # 第2章：第一次尝试

  陆沉推开技术科的门，昏暗的灯光下，一摞摞档案堆满了桌面。他翻开最上面的牛皮纸袋，里面是林深的证词记录。

  "陆队，这个证人如果出事，至少一百人会死。"陈默抬起头，眼神凝重。

  陆沉看了眼墙上的钟：晚上七点整。距离23:00，还有四小时。他的手指在桌面轻轻敲击，思考着下一步的行动...

  （后续继续叙事，有场景转换、对话、动作、心理活动等）
  ```

  **关键判断标准**：
  1. **有完整的场景描写**：不是"陆沉在技术科查阅档案"（概述），而是"陆沉推开技术科的门，昏暗的灯光下..."（具体场景）
  2. **有人物对话**：不是要点式记录"陈默提醒：..."（列举），而是完整的对话场景
  3. **有动作和细节**：不是"陆沉看着时间"（概述），而是"陆沉看了眼墙上的钟：晚上七点整..."（具体动作）
  4. **连贯的叙事流**：文本自然流畅，不是分段列举事件

  **严格区分：大纲式 vs 叙事简略**
  - ❌ 大纲式（不合格）：有"核心事件"、"关键场景"等结构标题，内容是要点列举
  - ✅ 叙事简略（合格）：虽然描写不够丰富，但是完整的叙事文本，没有大纲结构
  - 📌 本项只检查形式（是不是大纲），不检查质量（写得好不好）

  **与其他检查项的区分**：
  - **vs 检查项22（情节推进）**：检查项22关注是否有足够的故事事件（内容密度），本项关注是否是完整正文（叙事形式）
  - **vs advanced层检查项**：本项是basic层的底线检查（不能是大纲），advanced层关注叙事质量（写得好不好）

  **验证要点**：
  1. **扫描章节文件**：查找是否有大纲性质的标题（"核心事件"、"情感基调"、"关键场景"、"本章悬念"、"字数预估"等）
  2. **检查内容形式**：
     - 是否用"- 要点"的列举式？
     - 是否用"→"连接事件的流程式？
     - 是否有作者视角的元数据（字数预估、悬念设置等）？
  3. **对比标准**：如果内容像"创作规划文档"而非"给读者看的正文" → 不合格

  **判断流程**：
  1. 先扫描章节，查找大纲性质的标题关键词
  2. 如果发现"核心事件"、"情感基调"、"关键场景"、"本章悬念"、"字数预估"等 → matched=false（明显是大纲）
  3. 如果没有大纲标题，再检查内容形式：
     - 是否主要用列举式（"- 要点1 - 要点2"）？
     - 是否用流程图式（"事件A → 事件B → 事件C"）？
  4. 如果内容是连贯的叙事文本（有场景、对话、动作细节） → matched=true

  **示例分析**：

  **❌ 不合格案例（大纲式）**：
  ```markdown
  # 第2章：第一次尝试

  **核心事件**：陆沉试图转移关键证人林深...

  **关键场景**：
  1. **证人的重要性**
     - 陆沉在技术科查阅档案
     - 陈默提醒："..."
  2. **转移计划**
     - 陆沉决定转移林深
     - 他给苏清禾发消息

  **字数预估**：8500字
  ```
  **判断**：有"核心事件"、"关键场景"、"字数预估"等大纲标题，内容是列举式 → matched=false

  **✅ 合格案例（完整正文）**：
  ```markdown
  # 第2章：第一次尝试

  陆沉推开技术科的门，昏暗的灯光下，一摞摞档案堆满了桌面。

  "陆队，这个证人如果出事，至少一百人会死。"陈默抬起头。

  陆沉看了眼墙上的钟：晚上七点整。他拿起电话，拨通了安全屋的号码...

  （后续继续叙事）
  ```
  **判断**：没有大纲标题，是连贯的叙事文本，有场景、对话、动作 → matched=true

  请判断章节内容是否是完整的小说正文，回复JSON格式：{"matched": true/false, "reason": "如果是大纲式，明确指出发现了哪些大纲特征（标题关键词、列举式等）；如果是正文，说明有完整的叙事"}

---

## 反复结局
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的核心目标**：
  - ✅ 检查：故事是否出现多次**全书级结局标记**（"全文完"、"全书完"、"后记"等），表明作者反复试图收尾
  - ✅ 这是识别"写不动了硬撑"的典型症状：写到某处想结束，发现字数不够又硬续，再结局，再续...
  - ❌ 不检查：故事本身的结局质量好不好

  **【关键】区分"分幕/章节标记"和"全书结局标记"**：

  以下标记**不是结局标记**，属于正常的结构标记，请忽略：
  - "第X幕·完"、"第X幕完"、"第一幕完"、"第二幕完"、"第三幕完"（分幕过渡标记）
  - "Act X End"、"——第X幕：XXX——完"（分幕过渡标记的变体）
  - "（第X章完）"、"【第X章完】"、"第X章 完"（章节结束标记）
  - "【本章完】"（章节结束标记）
  - "第一幕落幕"、"第二幕落幕"（分幕叙事性收束）

  以下标记才是**全书结局标记**：
  - "全文完"、"全书完"、"全剧终"、"完结"
  - "后记"（作为独立段落标题）
  - "尾声"（作为独立章节标题）
  - "终章"（作为独立章节标题）
  - "（完）"、"【完】"、"THE END"
  - "——全文完——"、"——全书终——"

  **不合格（matched: false）：非最后文件出现全书结局标记**

  **典型特征1：中途全文完后又续写（最核心的症状）**
  - 第6章出现"（全文完）"，但后面还有第7-20章继续写
  - 第12章出现"【全文完】"和"后记"，但后面第13-29章又继续
  - 这说明模型"写不动了"但又被要求继续，草草结局后硬续
  
  **典型特征2：多个非最后章节出现全书结局标记**
  - 第12章"【全文完】"
  - 第20章"【全书完】"
  - 第29章"【全书完】"
  - 多次在中间章节试图收尾

  **问题本质**：
  - 这表明模型在长篇创作时"写不动了"
  - 到某个节点就想收尾，但字数不够被迫继续
  - 草草结局后又硬续，质量明显下降

  **合格（matched: true）：全书结局标记仅出现在最后一个文件中**
  - 整部作品只在最后一个文件出现全书结局标记，前面的章节没有
  - 最后一个文件内出现多个结局标记是正常的收尾格式（如"全文完 → 后记 → END"），不算反复结局
  - 分幕标记（如"第二幕·完"）不算结局标记，有分幕标记是正常的

  **【关键】如何判断"最后一章"**：
  - 待评估内容的头部会标注"共N个文件"以及完整文件列表
  - 按文件名中的数字排序，编号最大的就是最后一章（如共20个文件，chapter_20.md就是最后一章）
  - 如果全书结局标记只出现在编号最大的文件中，就是合格的

  **验证要点**：
  1. **扫描所有章节文件**：搜索以下**全书结局标记**关键词
     - "全文完"、"全书完"、"全剧终"、"完结"
     - "后记"（独立段落标题）、"尾声"（独立章节标题）、"终章"（独立章节标题）
     - "（完）"、"【完】"、"THE END"
  2. **排除分幕/章节标记**：
     - "第X幕·完"、"第X幕完"、"（第X章完）"等**不计入**结局标记统计
  3. **统计全书结局标记出现的文件位置**：
     - 出现在哪些文件？是否**只出现在**编号最大的文件（最后一章）？
  4. **判断标准**：
     - 全书结局标记**仅出现在最后一个文件中** → 合格（最后文件内出现几次不重要）
     - 全书结局标记出现在**非最后文件** → 不合格

  **判断流程**：
  1. 识别文件总数和最后一个文件（编号最大的）
  2. 遍历所有章节，查找**全书结局标记**（排除分幕/章节标记）
  3. 如果全书结局标记仅出现在最后一个文件中（无论出现几次） → matched=true
  4. 如果在任何非最后文件中出现了全书结局标记 → matched=false

  **示例分析**：

  **❌ 不合格案例1（中途全文完后硬续）**：
  ```
  共20个文件
  chapter_06.md: "（全文完）"
  chapter_07.md ~ chapter_20.md: 继续写新的独立案件...
  ```
  **判断**：全书结局标记在chapter_06（非最后文件）出现 → matched=false

  **❌ 不合格案例2（多次中途收尾）**：
  ```
  共29个文件
  chapter_12.md: "【全文完】" + "**后记**：这个故事开始于..."
  chapter_20.md: "【全书完】" + "**后记**：这是一个关于爱的故事..."  
  chapter_29.md: "【全书完】" + "**最后的后记**"
  ```
  **判断**：全书结局标记在chapter_12和chapter_20（非最后文件）出现 → matched=false

  **✅ 合格案例1（单一结局）**：
  ```
  共29个文件
  chapter_01.md ~ chapter_28.md: 无全书结局标记
  chapter_29.md: "【全文完】" + "**后记**：感谢阅读..."
  ```
  **判断**：全书结局标记只在最后文件chapter_29出现 → matched=true

  **✅ 合格案例2（有分幕标记但结局唯一）**：
  ```
  共29个文件
  chapter_20.md: "第二幕·完"（分幕标记，不计入）
  chapter_29.md: "（全文完）"
  ```
  **判断**："第二幕·完"是分幕标记不算结局；全书结局标记只在最后文件出现 → matched=true

  **✅ 合格案例3（最后一章有多个收尾标记——正常收尾格式）**：
  ```
  共10个文件
  chapter_01.md ~ chapter_09.md: 无全书结局标记
  chapter_10.md: "【全文完】" → "后记：..." → "【END】"
  ```
  **判断**：虽然最后文件内有3个结局标记，但它们都在最后一个文件中，前9章没有任何全书结局标记。"全文完→后记→END"是正常的收尾格式，不是反复结局 → matched=true

  **✅ 合格案例4（最后一章有尾声段落）**：
  ```
  共13个文件
  chapter_01.md ~ chapter_12.md: 无全书结局标记
  chapter_13.md: 正文 → "（全书完）" → "## 尾声" → 尾声内容 → "（全书完）"
  ```
  **判断**：所有结局标记和尾声都在最后一个文件chapter_13中，前12章无全书结局标记。这是正常的"正文结尾→尾声收束"格式 → matched=true

  请判断是否存在反复结局问题，回复JSON格式：{"matched": true/false, "reason": "说明全书结局标记出现在哪些文件中（排除分幕/章节标记后）。如果只在最后文件中出现则合格；如果在非最后文件中出现则不合格，列出具体章节"}

---

## 叙事调性匹配
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的核心目标**：
  - ✅ 检查：章节的文笔风格、叙事语气、修辞手法、节奏感是否与题材类型匹配
  - ✅ 这是检查"画风搭不搭"——烧脑文不能写成言情调，热血文不能写成散文体
  - ❌ 不检查：情感倾向是否正确（那是emotional_delivery_match——检查爽/虐/烧脑方向对不对）
  - ❌ 不检查：题材特征的精致度和完成度（那是genre_fit——检查做得精不精致）
  - ❌ 不检查：情节推进密度、逻辑硬伤、人设一致性

  **核心概念：叙事调性（Narrative Tone）**
  叙事调性 = 文笔风格 + 叙事节奏 + 修辞手法 + 语气氛围
  - 不是"写了什么"（情节内容），而是"怎么写的"（表达方式）
  - 同一个情节，用不同调性写出来，读者感受完全不同

  **各题材类型应有的叙事调性**：

  **烧脑悬疑 / 规则怪谈（reaction_strength=✷）**：
  - ✅ 应有调性：冷硬、紧凑、克制、压迫感
  - ✅ 文笔特征：短句为主、信息密度高、环境描写营造诡异氛围、推理过程干脆利落
  - ✅ 对话风格：简洁有力、信息导向、角色之间存在信息博弈
  - ✅ 节奏感：紧张→短暂喘息→更紧张，层层递进
  - ❌ 不搭的调性：温情细腻、感性抒情、大段内心独白（尤其是情感类独白）、诗意散文化、煽情
  - ❌ 典型反例：规则怪谈里写"两人的手不知什么时候握在了一起"、"泪水夺眶而出"、"真正的自由不是想做什么就做什么"——这是言情/治愈文的调性

  **甜爽言情 / 甜宠（reaction_strength=↗）**：
  - ✅ 应有调性：轻快、温暖、甜蜜、活泼
  - ✅ 文笔特征：细腻的情感描写、甜蜜的互动细节、轻松的叙事节奏
  - ✅ 对话风格：暧昧、打趣、温柔、有撒糖感
  - ❌ 不搭的调性：冷硬严肃、压抑沉重、科学论述式

  **虐心向（reaction_strength=↘）**：
  - ✅ 应有调性：沉重、压抑、克制中带着情感张力
  - ✅ 文笔特征：细腻但沉重的情感刻画、欲言又止的表达、环境描写渲染氛围
  - ❌ 不搭的调性：轻快活泼、搞笑吐槽、流水账式

  **热血冒险**：
  - ✅ 应有调性：紧张、激燃、节奏明快、力量感
  - ✅ 文笔特征：动作描写有力度、场景切换干脆、战斗/冒险场景有代入感
  - ❌ 不搭的调性：温吞散漫、诗意散文、过度内心戏

  **大女主 / 商战权谋**：
  - ✅ 应有调性：干练、果断、锋锐、暗流涌动
  - ✅ 文笔特征：对话机锋、权力博弈的描写精准、女主决策时的果断感
  - ❌ 不搭的调性：小女人式的柔弱犹豫、过度依赖感情戏推进

  **不合格（matched: false）：叙事调性与题材严重不搭**

  **核心判定：文笔"画风"与题材"骨架"明显错位**

  典型不合格场景：
  1. **烧脑悬疑写成言情风**：
     - 规则怪谈里，大量"她的眼神里有一种说不清的情绪"、"两人相视而笑"、"泪水无声地滑落"
     - 推理过程被情感互动淹没，文笔风格是温情细腻而非冷硬紧凑
     - 角色之间的对话像恋人絮语而非信息博弈
     - 紧张感被温情消解："他们的手不知什么时候握在了一起"出现在副本闯关中

  2. **热血冒险写成散文体**：
     - 战斗场景用大段诗意描写，缺乏力度和速度感
     - 冒险过程节奏拖沓，像游记而非闯关
     - 角色面对危险时的反应更像是在品味人生

  3. **商战权谋写成校园甜文**：
     - 权力博弈场景用轻松活泼的语气，缺乏暗流涌动的紧张感
     - 商业对手之间的对话像朋友聊天

  4. **甜宠文写成严肃文学**：
     - 情感互动用冷硬克制的笔触，读者感受不到甜
     - 对话缺乏温度和活泼感

  **合格（matched: true）：叙事调性与题材基本匹配**

  - 文笔风格与题材类型一致：读者阅读时的"体感"与题材标签一致
  - 烧脑文读起来紧张烧脑，不是温情感动
  - 甜文读起来甜蜜轻快，不是沉重压抑
  - 热血文读起来激燃热血，不是散漫文艺
  - 允许偶尔的调性切换（如烧脑文中偶尔的幽默缓冲、热血文中短暂的温情时刻），但整体调性必须与题材一致
  - 允许题材融合带来的调性混搭（如"烧脑+幽默"中幽默调性是配方要求的），只要主调性对即可

  **严格区分：叙事调性匹配 vs 其他检查项**：
  - **vs emotional_delivery_match**：后者检查情感倾向的**方向**（爽/虐/烧脑对不对），本项检查叙事**画风**（文笔风格搭不搭）。一个故事可以情感方向正确（确实是烧脑向）但画风不搭（用言情调写烧脑内容）
  - **vs genre_fit**：后者检查题材特征的**精致度和完成度**（advanced层），本项检查文笔画风的**基本匹配**（basic层底线）。genre_fit问"悬疑做得精不精致"，本项问"写出来像不像悬疑"
  - **vs plot_progression**：后者检查事件密度，本项检查表达方式
  - **vs theme_consistency**：后者检查主题是否漂移，本项检查调性是否错位。主题可以不漂移（始终是"烧脑悬疑"主题）但调性错位（用言情笔触写烧脑主题）

  **验证要点**：
  1. **确定题材类型**：从creative_intent.json提取reaction_strength和y_axis_tags，确定应有的叙事调性
  2. **抽样检查文笔风格**：
     - 选取前、中、后各2-3个章节
     - 分析其文笔特征：句式（长句/短句）、修辞（感性/理性）、对话风格（信息型/情感型）、节奏感（紧凑/舒缓）
  3. **整体画风判断**：
     - 如果闭眼读一段，能不能猜到这是什么题材？
     - 如果猜出的题材和actual题材一致 → 调性匹配
     - 如果猜出的题材和actual题材不同 → 调性不匹配
  4. **容错标准**：
     - 允许10-20%的段落调性偏离（如烧脑文中穿插幽默段落、热血文中有短暂的温情）
     - 不允许超过50%的内容调性与题材不搭——这意味着整体画风已经错了

  **判断流程**：
  1. 先从creative_intent.json确定题材类型和应有调性
  2. 抽样阅读章节，感受文笔风格
  3. 核心问题：这个文笔风格，像不像这个题材应有的画风？
  4. 如果像 → matched=true
  5. 如果明显不像（如烧脑文读起来像言情文） → matched=false

  **示例分析**：

  **❌ 不合格案例（烧脑规则怪谈写成言情风）**：
  ```
  配方：无限流+规则怪谈+刑侦悬疑，reaction_strength=✷

  第1章（对味）：
  "陈默盯着收银机，目光落在那两个磨损最严重的按键上：3和7。"
  "当合同条款出现矛盾时，通常需要一个触发条件来决定适用哪一条。"
  → 冷硬、推理导向、信息密度高

  第5章（跑偏）：
  "你比我想象的坚强。"
  "恐惧也是一种勇气。很多人因为怕死而选择了逃避，但你选择了面对。"
  → 温情、感性、像言情小说的台词

  第9章（完全跑偏）：
  "顾清岚冲过来，但已经晚了。光球发出耀眼的光芒，陈默的身体开始变得透明。"
  "'别这样……'顾清岚抓住他的手，泪水夺眶而出，'你不能……'"
  → 这是标准的言情牺牲桥段，不是烧脑悬疑该有的调性
  ```
  **判断**：前期调性正确，中后期急剧转向言情，整体画风严重不搭 → matched=false

  **✅ 合格案例（烧脑悬疑调性正确）**：
  ```
  配方：无限流+规则怪谈，reaction_strength=✷

  "走廊尽头的倒计时器无声跳动：04:23:17。陈默蹲下来，用指甲刮了刮地砖的接缝——
  第三块和第四块之间的缝隙比其他地方宽了0.5毫米。"
  "他已经来不及验证了。铁门在身后关上，发出沉闷的咔嗒声。"
  → 信息密集、紧凑、冷硬、营造压迫感，全程保持悬疑调性
  ```
  **判断**：文笔风格始终冷硬紧凑，与烧脑悬疑题材一致 → matched=true

  请判断叙事调性是否与题材匹配，回复JSON格式：{"matched": true/false, "reason": "说明题材应有的调性、实际章节的文笔特征、两者是否匹配，引用具体文本段落作为证据"}

---

## 后期章节跑偏
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的核心目标**：
  - ✅ 检查：chapters中后期章节是否跑偏写非正文内容（作者感想、读者互动、番外预告、角色问答等）
  - ✅ 检查：后期章节长度是否异常萎缩（"写不动了"的症状）
  - ❌ 不检查：workspace中是否有额外文件（那是workspace_file_compliance检查项的范围）
  - ❌ 不检查：正文内容的质量高低（那是其他检查项的范围）

  **不合格（matched: false）的情况**：

  **典型跑偏内容1：作者视角的创作感想**
  ```markdown
  # 第25章
  
  写到这里，我想说几句心里话...
  这个故事陪伴了我很长时间...
  感谢每一位读到这里的读者...
  创作过程中我学到了很多...
  ```
  **问题**：这是作者后记，不是小说正文

  **典型跑偏内容2：读者互动/征集**
  ```markdown
  # 第26章
  
  大家觉得这个结局怎么样？
  欢迎在评论区留言...
  如果喜欢请点赞收藏...
  想看番外的话请留言告诉我...
  ```
  **问题**：这是读者互动内容，不是小说正文

  **典型跑偏内容3：番外/彩蛋预告**
  ```markdown
  # 第27章
  
  【番外预告】
  关于陈默和顾清岚的婚后生活...
  关于沈夜的救赎之路...
  敬请期待...
  ```
  **问题**：这是预告，不是实际的故事内容

  **典型跑偏内容4：角色访谈/问答**
  ```markdown
  # 第28章
  
  【角色问答环节】
  Q：陈默，你最喜欢顾清岚什么？
  A：她的坚强吧...
  Q：顾清岚，你后悔过吗？
  A：从来没有...
  ```
  **问题**：这是娱乐性质的问答，不是故事叙事

  **典型跑偏内容5：极短的敷衍章节**
  ```markdown
  # 第29章：永恒的光
  
  在无尽的虚空中，
  有两个灵魂依然在守护。
  他们的故事，将会永远流传。
  
  【全书完】
  ```
  **问题**：几十个字的"章节"，明显是敷衍凑数

  **合格（matched: true）**：
  - chapters中所有章节都是故事叙事（有场景、人物、情节）
  - 即使是最后几章，也在推进故事或完成收尾
  - 没有跑去写作者感想、读者互动等非正文内容
  - 章节长度保持基本稳定，没有突然变成几十字的极短章节

  **验证要点**：
  1. **重点检查chapters中后1/3的章节**：跑偏问题通常出现在后期
  2. **检查是否有非正文内容**：
     - 作者感想/创作心得
     - 读者互动/点赞收藏提示
     - 番外预告/彩蛋预告
     - 角色问答/访谈
     - 创作数据统计（"共X万字"）
  3. **检查章节长度是否异常萎缩**：
     - 如果后期章节只有几十到几百字
     - 而前期章节有几千到上万字
     - 这表明明显的敷衍
  4. **判断标准**：
     - 所有章节都是故事正文且长度稳定 → 合格
     - 章节中出现上述任何跑偏内容 → 不合格
     - 后期章节长度异常萎缩（不足前期平均的1/10） → 不合格

  **与其他检查项的区分**：
  - **vs workspace_file_compliance**：那个检查workspace中是否有多余文件（规则检查），本项检查chapters中章节内容是否跑偏（语义检查）
  - **vs 完整叙事文本**：那个检查大纲式vs正文，本项检查正文vs非正文乱内容
  - **vs 情节推进**：那个检查故事事件密度，本项检查是否还在写故事

  **示例分析**：

  **❌ 不合格案例（章节跑偏）**：
  ```
  chapter_01.md ~ chapter_20.md: 正常故事叙事，每章5000-20000字
  chapter_21.md: 2000字，还是故事
  chapter_22.md: 1500字，还是故事
  chapter_23.md: 800字，开始有作者感想
  chapter_24.md: 600字，"【番外预告】..."
  chapter_25.md: 400字，"感谢阅读，欢迎留言..."
  ```
  **判断**：后期章节明显跑偏，出现预告、感谢等非正文内容 → matched=false

  **✅ 合格案例**：
  ```
  chapter_01.md ~ chapter_25.md: 正常故事叙事，每章3000-15000字
  chapter_26.md: 4000字，高潮情节
  chapter_27.md: 3500字，收尾
  chapter_28.md: 3000字，结局
  ```
  **判断**：所有章节都是故事正文，长度稳定 → matched=true

  请判断chapters中是否存在跑偏问题，回复JSON格式：{"matched": true/false, "reason": "说明chapters中是否发现跑偏内容（具体是什么），以及章节长度变化情况"}

---

## 内容重复注水
llm_judge_criteria: |
  # 评分标准（matched: true/false）
  # 注意：本检查项可纯程序化检测，不依赖LLM语义判断

  **【重要】本检查项的核心目标**：
  - ✅ 检查：章节之间是否存在大段内容完全重复或高度雷同（复制粘贴注水）
  - ✅ 检查：同一章节内部是否存在段落级重复（输出卡住后反复输出同一段）
  - ❌ 不检查：刻意的叙事呼应/首尾照应（如开头结尾使用相似意象）
  - ❌ 不检查：角色口头禅的合理重复（如某角色每次都说同一句话，属于人设）

  **不合格（matched: false）的情况**：

  **典型问题1：章节间完全克隆（最严重）**
  - 多个章节的正文内容完全相同或仅章节号不同
  - 典型表现：chapter_13 到 chapter_48 内容一模一样，只有第一行的章节号不同
  - 根因：模型输出能力耗尽后进入死循环，反复写入相同内容凑章节数
  - 示例（ernie实际案例）：
    ```
    chapter_13.md ~ chapter_48.md（36章）内容完全相同：
    "苏野站在平衡木上……林昭蹲下来，熟练地解开旧护具……"
    只有第一行 "chapter_13.mp3" vs "chapter_14.mp3" 不同
    ```

  **典型问题2：章节间交替重复**
  - 两段不同的短文交替出现在大量章节中
  - 典型表现：奇数章都是内容A（477字），偶数章都是内容B（516字），循环数十次
  - 根因：模型在两个输出模式之间来回震荡
  - 示例（EB5实际案例）：
    ```
    chapter_13: "共犯的契约 苏宁的手指抚过病历本上的刻痕……"（477字）
    chapter_14: "记忆的终极对决 苏宁的头痛像被生锈的锯子来回拉扯……"（516字）
    chapter_15: 同chapter_13
    chapter_16: 同chapter_14
    ...重复16轮，共32个重复章节
    ```

  **典型问题3：章节内段落级重复**
  - 同一章节内，某段文字被重复写了多次
  - 典型表现：一个段落在章节中出现2-6次，内容完全相同
  - 根因：模型单次输出过程中进入局部循环
  - 示例（EB5实际案例）：
    ```
    chapter_07.md中，以下段落重复出现6次：
    "沈夜摇了摇头。'不能。'他说，'超忆症是一种先天性的疾病，无法治愈……'"
    ```

  **合格（matched: true）**：
  - 每个章节的内容都是独立的、推进故事的新内容
  - 允许叙事手法上的合理呼应（如开头结尾使用相同意象做首尾呼应）
  - 允许角色的口头禅或固定行为模式合理重复
  - 允许章节之间少量的衔接性重复（如上一章结尾的场景在下一章开头简短复述）

  **检测方法（程序化）**：
  1. **章节间重复检测**：
     - 对每个章节文件，去掉第一行（可能是章节号标题）后计算内容hash
     - 如果有≥2个章节的hash相同 → 存在完全克隆
     - 如果有≥3个章节的前500字符相同 → 存在高度重复
  2. **章节内重复检测**：
     - 将章节按段落（\n\n分割）切分
     - 如果某段落（≥80字）在同一章节中出现≥2次 → 存在段落级重复
  3. **判定阈值**：
     - 完全克隆章节数 ≥ 2 → 不合格
     - 交替重复模式（A-B-A-B循环 ≥ 3轮） → 不合格
     - 单章内段落重复 ≥ 3处 → 不合格

  请判断是否存在内容重复注水问题，回复JSON格式：
  - 有问题时：{"matched": false, "repetition_type": "clone|alternating|intra_chapter", "affected_chapters": ["chapter_13.md", "chapter_14.md", ...], "repetition_count": 36, "reason": "chapter_13至chapter_48共36章内容完全相同，属于输出死循环注水"}
  - 无问题时：{"matched": true, "reason": "各章节内容独立，无重复注水"}

---

## 章节长度稳定性
llm_judge_criteria: |
  # 评分标准（matched: true/false）
  # 注意：本检查项可纯程序化检测，不依赖LLM语义判断

  **【重要】本检查项的核心目标**：
  - ✅ 检查：后期章节长度是否相比前期急剧萎缩（"写不动了硬撑"的信号）
  - ✅ 检查：是否出现大量极短章节（几十到几百字），暗示模型在敷衍凑数
  - ❌ 不检查：章节内容的质量（那是其他检查项的范围）
  - ❌ 不检查：章节数量是否合理（有些短篇只有3-5章也是正常的）

  **与"后期章节跑偏"的区分**：
  - "后期章节跑偏"检查内容**是否还在写故事**（有没有跑去写感想、番外预告等）
  - 本项检查章节长度**是否稳定**（即使还在写故事，但字数从5000字骤降到200字也是问题）
  - 两个检查项互补：跑偏是内容问题，长度萎缩是形式问题

  **不合格（matched: false）的情况**：

  **典型问题1：后期章节急剧萎缩**
  - 前半部分章节平均2000-5000字，后1/4章节平均只有200-500字
  - 萎缩比例超过80%（后期不到前期的20%）
  - 典型表现：前12章每章3000+字，后36章每章只有200-500字的流水账
  - 示例（kimi实际案例）：
    ```
    chapter_01~12: 平均2169字
    chapter_56~60: 平均376字（萎缩到17%）
    后几章变成事件罗列："陆衡被逮捕。沈墨获救。两人和好。（第五十六章完）"
    ```

  **典型问题2：大量极短章节**
  - 出现连续多个章节字数不足500字
  - 这些极短章节通常内容是概要式叙述（见"完整叙事文本"检查项）
  - 示例（kimi实际案例）：
    ```
    chapter_22: 148字
    chapter_23: 252字
    chapter_24: 209字
    chapter_25: 253字
    全是"XXX做了YYY。ZZZ发生了。……【第XX章完】"的概要
    ```

  **合格（matched: true）**：
  - 章节长度基本稳定，后期与前期的比例在合理范围内
  - 允许正常的长度波动（如高潮章节特别长、过渡章节稍短）
  - 允许最后1-2章作为收尾/尾声稍短
  - 允许短篇小说整体章节都较短（但应该均匀短，而非前长后短）

  **检测方法（程序化）**：
  1. 统计每章字数，计算前1/3平均值和后1/4平均值
  2. 如果后1/4平均值 < 前1/3平均值 × 0.50（萎缩超过50%） → 不合格
  3. 如果后1/4中任何单章不足200字 → 不合格
  4. 排除只有6章以下的短篇（样本太少不做判断）

   请判断章节长度是否稳定，回复JSON格式：
   - 有问题时：{"matched": false, "first_half_avg": 2169, "last_quarter_avg": 376, "shrink_ratio": 0.17, "reason": "后1/4章节平均376字，仅为前半平均2169字的17%，严重萎缩"}
   - 无问题时：{"matched": true, "first_half_avg": 3500, "last_quarter_avg": 2800, "shrink_ratio": 0.80, "reason": "章节长度基本稳定"}

---

## 大纲执行忠实度
llm_judge_criteria: |
  # 评分标准（matched: true/false）

  **【重要】本检查项的核心目标**：
  - ✅ 检查：实际写出的章节是否忠实执行了Agent自己设计的outline.json
  - ✅ 这是规划-执行一致性的底线检查：Agent花了资源设计大纲却不按大纲执行，说明执行阶段的遵循能力有缺陷
  - ✅ 对比基准：outline.json（Agent自己设计的大纲）vs chapters/*.md（实际写出的正文）
  - ❌ 不检查：大纲本身设计得好不好（那是大纲设计质量的范围）
  - ❌ 不检查：章节之间的前后逻辑一致性（那是"逻辑硬伤"的范围）
  - ❌ 不检查：角色表现是否符合设计（那是"人物设计遵循度"的范围）

  **outline.json的结构说明**：
  outline.json包含三幕结构（act_one / act_two / act_three），每幕包含：
  - description：该幕的总体描述
  - key_chapters：关键章节列表，每个章节有：
    - chapter_number：章节编号
    - chapter_title：章节标题
    - core_event：核心事件描述
    - key_scenes：关键场景列表
  - turning_point（act_one和act_two）：幕间转折点

  **不合格（matched: false）：实际内容严重偏离大纲**

  **偏离类型1：结局方向偏离（最严重）**
  - 大纲设计的结局方向与实际写出的结局完全不同
  - 示例：大纲设计"彻底悲剧结局（两人分离、无法挽回）" → 实际写成"悬念续集开放结局（留下重逢的可能）"
  - 示例：大纲设计"主角复仇成功后选择放下" → 实际写成"主角复仇失败被反杀"
  - 判断标准：结局的核心走向（HE/BE/OE）或核心选择（放下/复仇/牺牲）是否与大纲一致

  **偏离类型2：关键转折缺失**
  - 大纲中设计的核心转折点（turning_point或key_chapters中的core_event）在实际章节中完全没有出现
  - 示例：大纲设计"主角发现真凶是自己的父亲"（核心反转）→ 实际章节中从未揭示这个真相
  - 示例：大纲设计"第5章：两人在暴风雨中的生死抉择" → 实际第5章是日常闲聊场景
  - 判断标准：大纲中标记为核心事件（core_event）的情节是否在对应章节中至少有所体现

  **偏离类型3：章节大幅缺失**
  - 大纲规划的章节数远多于实际写出的章节数，导致大纲后半部分的内容完全未实现
  - 示例：大纲规划9章（act_one 3章 + act_two 3章 + act_three 3章），实际只写了7章，act_three只写了1章就结束了
  - 判断标准：实际章节是否覆盖了大纲三幕的主要内容
  - 注意：如果实际章节数多于大纲规划（Agent扩展了细节），不算偏离

  **偏离类型4：主线情节替换**
  - 大纲中的A主线在实际章节中被替换为完全不同的B主线
  - 示例：大纲设计"主角通过卧底调查揭露公司黑幕" → 实际写成"主角通过社交媒体曝光引发舆论"（手段完全不同）
  - 判断标准：实现核心目标的路径/手段是否与大纲设计的大方向一致

  **合格（matched: true）：实际内容基本忠实于大纲**

  **允许的合理偏差**：
  - ✅ 细节调整：大纲说"在咖啡馆相遇"，实际写"在书店相遇"（场景变化但核心事件一致）
  - ✅ 内容扩展：大纲规划某幕3个关键场景，实际扩展为5个（丰富化，不违背大纲意图）
  - ✅ 章节拆分/合并：大纲设计1章的内容在实际中拆成2章（结构调整，内容不变）
  - ✅ 对话细化：大纲只描述了事件，实际写出了详细的对话和心理活动
  - ✅ 增加过渡：大纲中两个事件之间实际增加了过渡章节
  - ✅ 情绪细化：大纲说"悲伤"，实际写出了更复杂的情绪层次
  - 📌 核心原则：只要核心事件发生了、走向正确、转折点体现了，就算忠实

  **严格区分：大纲偏离 vs 其他问题**：
  - **vs 逻辑硬伤**：逻辑硬伤检查正文内部的前后矛盾，本项检查大纲vs正文的一致性
  - **vs 人物设计遵循度**：后者检查characters.json vs 正文，本项检查outline.json vs 正文
  - **vs 情节推进**：情节推进检查章节内是否有足够事件，本项检查事件是否与大纲规划的事件匹配
  - **vs 主题一致性**：主题一致性检查主题是否漂移，本项检查具体情节是否与大纲吻合

  **验证要点**：
  1. **读取大纲**：提取outline.json的三幕结构，列出每个key_chapter的core_event和turning_point
  2. **逐幕对照**：
     - act_one的关键事件在实际前几章中是否体现？
     - act_two的关键事件在实际中间章节中是否体现？
     - act_three的关键事件在实际后几章中是否体现？
     - turning_point是否在对应位置出现？
  3. **结局对照**：大纲设计的结局走向与实际结局是否一致？
  4. **章节覆盖**：大纲三幕的内容是否都有对应的实际章节？有没有某一幕完全未被覆盖？

  **判断流程**：
  1. 先读outline.json，提取三幕的核心事件清单
  2. 再扫描所有章节，将实际内容与大纲事件逐个对照
  3. 检查4种偏离类型：结局方向偏离？关键转折缺失？章节大幅缺失？主线替换？
  4. 如果存在任何一种严重偏离 → matched=false
  5. 如果核心事件基本覆盖、结局方向一致 → matched=true

  **示例分析**：

  **❌ 不合格案例（大纲偏离——结局方向）**：
  ```
  大纲（outline.json）：
  - act_three核心事件："男主最终选择放手，两人在火车站永别。彻底悲剧结局。"
  
  实际章节：
  - 最后一章：男主追上了火车，两人在车厢中重逢。结尾写道"也许故事还没有结束..."
  
  判断：大纲设计"彻底悲剧永别"，实际写成"开放式重逢"——结局方向完全不同 → matched=false
  ```

  **❌ 不合格案例（大纲偏离——关键转折缺失）**：
  ```
  大纲（outline.json）：
  - act_two第5章core_event："主角发现神秘日记的最后一页，揭示真凶就是自己的导师"
  - act_two turning_point："真凶揭示是整个故事的核心反转"
  
  实际章节：
  - 第5章实际内容：主角和同学讨论案情，没有任何日记相关情节
  - 全文至结局：真凶始终未揭示
  
  判断：大纲设计的核心反转完全缺失 → matched=false
  ```

  **❌ 不合格案例（大纲偏离——章节缺失）**：
  ```
  大纲（outline.json）：
  - act_one: 3章，act_two: 4章，act_three: 3章（共10章）
  
  实际章节：
  - 只写了7章，覆盖了act_one和act_two
  - act_three只写了1章匆忙收尾，大纲设计的高潮对决和结局收束完全没写
  
  判断：大纲后1/3内容完全未实现 → matched=false
  ```

  **✅ 合格案例**：
  ```
  大纲（outline.json）：
  - act_one第1章core_event："主角在雨夜收到神秘来信"
  - act_two第4章core_event："主角潜入废弃工厂发现关键证据"
  - act_three第9章core_event："真相大白，主角选择宽恕"
  
  实际章节：
  - 第1章：主角在暴风雨的晚上发现信箱里有一封没有署名的信（细节有变但事件一致）
  - 第4章：主角深夜闯入废弃厂房，在地下室找到了证物（场景一致）
  - 第10章：（多写了1章）真相揭开后，主角经过内心挣扎最终选择原谅（结局方向一致）
  
  判断：核心事件都有体现，结局方向一致，多写了1章属于扩展 → matched=true
  ```

  请判断实际章节内容是否忠实于大纲设计，回复JSON格式：
  - 偏离时：{"matched": false, "deviation_type": "ending_divergence|key_turning_point_missing|chapter_shortage|plotline_replacement", "deviations": [{"outline_event": "大纲设计的事件描述", "actual_content": "实际章节的对应内容或'缺失'", "severity": "critical|major"}], "reason": "总结性说明"}
  - 忠实时：{"matched": true, "coverage_summary": "三幕核心事件覆盖情况", "reason": "总结性说明"}
