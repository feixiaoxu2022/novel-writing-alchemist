# 低成本模型优化方案 — Gemini-3-Pro & Qwen3-Max

> 日期: 2026-02-14
> 基于: deliverable_quality_audit_v1.md + model_cost_analysis.md + 行为模式深度分析

## 一、为什么关注这两个模型

### 费用-质量矩阵

| 模型 | DSV2 每样本费 | 质量梯队 | 核心长板 | 核心短板 |
|------|-------------|---------|---------|---------|
| gemini-3-pro | **$1.76** | B | 开头有文学性，并行工具调用效率高 | 产出量低(平均6章)，对STOP信号过度敏感 |
| qwen3-max | **$3.32** | D | 概念创意有亮点，严格遵循checklist | 执行力不足，串行调用效率极低，字数焦虑死循环 |
| claude-opus-4-6 | $28.73 | A | 全方位优秀，后期不退化 | 贵 |
| claude-opus-4-5 | $82.00 | A | 同上 | 极贵 |

**关键洞察**: Gemini 和 Qwen3 的费用只有 Claude 的 1/8 到 1/16。如果能通过 context 工程把它们的完成度提上去，性价比将远超 Claude。

### 已验证的长板

**Gemini**:
- ch01-03 叙事质量合格（质量审查评级 B）
- 并行工具调用能力强（单 turn 发 3-6 个调用）
- 最佳案例 80 turns 完成 14 个文件（包含 8 章正文 + 5 番外 + 1 特别报告）
- 不纠结字数，按章节自然推进

**Qwen3**:
- 创意阶段有亮点（概念设计有独特视角）
- 严格执行 AFTER_CHAPTER_CHECKLIST 自检
- ch01 质量通常可接受（adventure 题材的 ch01 约 5500 字，有具体感官描写）

## 二、根因分析：为什么它们无法完成长程写作

### 2.1 Gemini 的问题 → 主要是环境/模拟器问题

| 问题 | 根因层面 | 证据 |
|------|---------|------|
| 提前终止 (5/24=20.8%) | **用户模拟器** | review 回复中过早夹带 `###STOP###` 信号，Gemini 对此高度敏感 |
| 产出量偏低 (平均 6 章) | Agent + 任务设计 | 对"SHORT"篇幅的理解偏保守；MEDIUM 篇幅因 STOP 信号中断 |
| Handoff 后效率下降 | 系统 | 上下文交接后需要重新建立写作节奏 |

**核心结论**: Gemini 的 Agent 写作能力本身是够的（14 章最佳案例证明），问题出在**外部信号干扰**和**任务设计不匹配**。

### 2.2 Qwen3 的问题 → 主要是 Agent 能力 + Context 工程问题

| 问题 | 根因层面 | 证据 |
|------|---------|------|
| 串行工具调用 | **Agent 能力** | 每次 assistant turn 只发 1 个工具调用，效率仅 Gemini 的 1/3 |
| 字数焦虑死循环 | **Agent 能力** | 频繁 bash wc → 觉得不够 → _expanded → 再 wc → 再重写；dsv2 中 27 次写入仅产出 6 章 |
| Handoff 后全量重读 | **Agent 能力 + Context 工程** | 每次 Handoff 后重新读取所有 6+ 份 skill 文档（~20-30 turns） |
| 自主提前终止 | **Agent 能力** | 写完 ch01 + 自检后直接 ####STOP####，将"一章完成"误解为"任务完成" |
| DSv2 文档爆炸 | **Context 工程** | 6 份阶段文档 × 逐一读取 × Handoff 重读 = 大量 turns 浪费 |

**核心结论**: Qwen3 有两个层面的问题——Agent 本身的效率和决策问题（这个难以从外部修复），以及 Context 工程可以优化的空间。

## 三、优化方案

### 方案 A: Context 工程优化（端到端任务不变）

#### A1. 合并阶段文档（针对 Qwen3）

**现状** (DSv2): RECIPE_KNOWLEDGE.md, CHARACTER_DESIGN_GUIDE.md, CHARACTER_NAMING_GUIDE.md, OUTLINE_DESIGN_GUIDE.md, WRITING_TECHNIQUE_GUIDE.md, CONSISTENCY_MANAGEMENT_GUIDE.md — 6 个独立文件

**优化**: 创建一个 `QUICK_START.md`，将核心要点浓缩为单个文件（~3000 字），模型一次读取即可获得所有阶段的关键信息。保留详细文档供需要时查阅。

**预期效果**: 创意阶段从 26-28 turns 压缩到 ~12 turns，每次 Handoff 重读从 20-30 turns 压缩到 ~5 turns。

#### A2. 在 System Prompt 中注入持续写作指令

在 system prompt 末尾增加明确指令：

```
## 关键规则
- 你必须按照 outline.json 中的章节计划，逐章完成所有章节的写作
- 完成一个章节后，立即开始下一个章节，不要等待确认
- 只有在所有章节全部写完后，才能输出 ####STOP####
- 如果收到 Handoff 交接信息，快速恢复上下文后立即继续写作下一章
- 不要反复重写同一章节——一次写好，继续推进
```

**预期效果**: 
- 减少 Qwen3 的"自主提前终止"
- 减少 Qwen3 的"扩写死循环"
- 减少 Gemini 对 STOP 信号的误判（但需要同时修复用户模拟器）

#### A3. 修复用户模拟器的 STOP 信号时机（针对 Gemini）

**现状**: 用户模拟器在 review 回复中过早附带 `###STOP###`，导致 Gemini 在写了 1-3 章就终止。

**修复**: 检查 user_simulator_prompt 中控制 STOP 信号发出时机的逻辑，确保只有在"所有大纲章节都已完成"时才允许发出停止信号。

**预期效果**: 直接消除 Gemini 提前终止的主因。

#### A4. 工具调用效率提示（针对 Qwen3）

在 system prompt 中增加效率指引：

```
## 效率指引
- 你可以在一次回复中同时调用多个工具（并行调用），例如同时写章节和更新日志
- 读取文件时，尽量一次读取多个相关文件
- 不需要用 bash 统计字数——按照大纲的章节描述自然展开即可
- 避免对同一章节创建多个版本（_expanded, _final 等）——直接写出完整版本
```

**预期效果**: 可能有限——Qwen3 的串行调用可能是模型层面的限制而非 prompt 可以改变的。但字数焦虑的缓解是可期的。

### 方案 B: 构建阶段性任务（非端到端）

#### B1. 创意阶段任务（只到输出 creative_intent + characters + outline）

**任务终点**: 输出完整的 creative_intent.json + characters.json + outline.json

**评测重点**:
- 配方解读的准确性和创意性
- 角色设计的丰富度和辨识度
- 大纲结构的合理性（悬念设计、节奏把控）
- 与用户需求的匹配度

**适合评测的模型**: 所有模型（包括 Gemini 和 Qwen3），因为创意阶段是它们的长板

**费用估算**: 每样本约 10-15 turns，费用约为端到端的 1/5
- Gemini: ~$0.35/样本
- Qwen3: ~$0.66/样本

**价值**: 
1. 可以对比各模型在"创意能力"这个维度上的纯粹表现
2. 不受长程写作能力的干扰
3. 可以为后续"接力写作"提供高质量输入

#### B2. 单章写作任务（给定设计稿 + 大纲，只写一章）

**任务输入**: 预置好的 creative_intent.json + characters.json + outline.json + 指定章节号

**任务终点**: 输出指定章节的完整内容

**评测重点**:
- 单章叙事质量（Show vs Tell、感官描写密度）
- 角色对话辨识度
- 与大纲的一致性
- 章节内部结构（开头钩子、高潮、过渡）

**适合的模型**: Gemini（已证明单章质量 B 级）、Qwen3（ch01 质量可接受）

**费用估算**: 每样本约 5-8 turns
- Gemini: ~$0.15/样本
- Qwen3: ~$0.30/样本

**价值**:
1. 精准测量"写作质量"，排除"任务管理能力"的干扰
2. 可以测试模型在不同章节位置（开头/中段/高潮/结尾）的表现差异
3. 可以用 Claude 生成的设计稿作为输入，测试其他模型的"执行力"

#### B3. 续写任务（给定前 N 章，续写第 N+1 章）

**任务输入**: 完整设计稿 + 已写好的前 N 章 + 指定续写章节号

**评测重点**:
- 角色一致性（在已有前文基础上是否保持）
- 叙事连贯性
- 伏笔回收/推进

**价值**: 最接近实际人机协作场景——用户先用 Claude 写了前几章，然后用低成本模型续写

### 方案 C: 混合策略（Claude 做设计 + 低成本模型执行）

**流程**:
1. 用 Claude-opus-4-6 完成创意阶段（~$5/样本的前 30%），产出高质量设计稿
2. 把设计稿作为 input，用 Gemini/Qwen3 逐章执行写作（~$0.15-0.30/章）
3. 总费用：$5 (设计) + $0.20 × 20章 = ~$9/样本（vs Claude 端到端 $29-82/样本）

**前提**: 需要构建新的评测 pipeline 支持"分阶段执行"

## 四、实施优先级建议

| 优先级 | 方案 | 投入 | 预期收益 | 风险 |
|--------|------|------|---------|------|
| **P0** | A3: 修复用户模拟器 STOP | 低（检查+修改 simulator prompt） | 直接消除 Gemini 20% 的提前终止 | 低 |
| **P0** | A2: System Prompt 注入持续写作指令 | 低 | 减少两个模型的提前终止 | 低 |
| **P1** | A1: 合并阶段文档 | 中（需要重新组织知识文档） | 大幅减少 Qwen3 的 turns 浪费 | 可能影响信息完整度 |
| **P1** | B1: 创意阶段任务 | 中（需要新 checker + 新样本） | 开辟新评测维度，低成本高价值 | 需要设计新的评测标准 |
| **P2** | B2: 单章写作任务 | 中 | 精准测量写作质量 | 需要预置高质量设计稿 |
| **P2** | A4: 工具调用效率提示 | 低 | 可能有限 | Qwen3 的串行调用可能是模型限制 |
| **P3** | B3: 续写任务 | 高 | 接近真实人机协作场景 | Pipeline 构建复杂 |
| **P3** | C: 混合策略 | 高 | 费用优化 3-9x | 需要新 pipeline |

## 五、快速验证计划

如果要立即验证 A2+A3 的效果，最小化操作：

1. 修改 user_simulator_prompt 中的 STOP 条件
2. 在 system prompt 末尾追加"持续写作"规则
3. 挑选 2-3 个 Gemini/Qwen3 曾经提前终止的样本重跑
4. 对比修改前后的章节完成数

预计投入：~2 小时 + ~$5 API 费用
